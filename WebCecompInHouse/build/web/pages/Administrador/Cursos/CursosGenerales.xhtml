<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:a="http://xmlns.jcp.org/jsf/passthrough">


    <body>
        <ui:composition template="./../plantilla/plantilla.xhtml">
            <ui:define name="top">
                <ui:include src="MenuConfiguracion.xhtml"></ui:include>
            </ui:define>
            <ui:define name="content">
            
               
                <div class="container-fluid">   
                    <div class="card bg-secondary text-white font-weight-bold "  style="height: 50px" >
                           <div class="card-body"  > <h4 style="font-size: 1rem"> Cursos/Talleres Generales </h4> </div>
                       </div>
                   <br></br>
                    <h:form id="FormcursosGCab">
                    <div class="row">
                        <div class="col-lg-3">
                            <h:selectOneMenu  id="inversselecvt"  value="#{cursoDetController.tipoEnsenanza}" a:class="custom-select mb-3">
                                         <f:selectItem  itemLabel="Curso" itemValue="1" />  
                                         <f:selectItem  itemLabel="Taller" itemValue="2" />  
                                  </h:selectOneMenu>
                        </div>
                        <div class="col-lg-5">
                              <h:inputText value="#{cursoDetController.nomcur_found}" a:class="form-control" a:type="text" ></h:inputText>
                        </div>    
                        <div class="col-lg-2">
                            <p:commandLink 
                                actionListener="#{cursoDetController.doTamanoPaginacionCursoDetFiltro()}"
                                action="#{cursoDetController.doBuscarCursoDetFiltro()}"
                                     update=":FormcursosGener :pagCurDet" 
                                     style="height: 35px;"
                                      class="btn btn-secondary btn-sm" 
                                      onstart="PF('loading').show();" 
                                         oncomplete="PF('loading').hide();"  >
                                  <i class="fas fa-search"></i> 
                                  </p:commandLink>
                        </div>
                    </div>
                     </h:form>
                    <br></br>
                  
                    <div class="row">
                        <div class="col-lg-12">
                            <h:form id="FormcursosGener">
                                    <p:tooltip />
                                    <p:growl id="msgbox" showDetail="true" showSummary="false"/>
                                
                                <div class="table-responsive" align="center">
                                    <table class="panel table table-hover" >
                                        <thead class="panel-heading" style="background-color: #eeeeee; color: #004276; ">
                                            <tr class="text-center">
                                                <th>#</th>
                                                <th>Tipo</th>
                                                <th>Nombre</th>
                                                <th>Nivel</th>
                                                <th>Horas Lectivas</th>
                                                <th>Editar</th>
                                                <th>Borrar</th>
                                                <th>Plan/Temario</th>
                                                <th colspan="2">Configuracion</th> 
                                            </tr>
                                        </thead>
                                        <tbody  style="color: #000000; background-color: white;overflow-y:scroll;">
                                            <p:repeat  value="#{cursoDetController.lstCursoDet}" var="item">
                                                <tr>
                                                    <td class="text-center"><h:outputText  value="#{item.idCursoDet}"/></td>
                                                    <td class="text-center"> 
                                                        <h:outputText rendered="#{item.modEnsenanza==1}"  value="Curso"/>  
                                                        <h:outputText rendered="#{item.modEnsenanza==2}"  value="Taller"/> 
                                                    </td>
                                                    
                                                    <td class="text-center"> <h:outputText   value="#{item.cepCecCursoCab.nomCurso}"/>    </td>
                                                    <td class="text-center"><h:outputText value="#{item.cepNivel.nombreNivel}"/></td>
                                                    <td class="text-center"><h:outputText value="#{item.horasLectivas}"/></td>
                                                    <td class="text-center">
                                                        <p:commandLink 
                                                            rendered="#{cursoDetController.doValidarPlanIdCursoDet(item.idCursoDet)== 0}" 
                                                            actionListener="#{cursoDetController.doCapturarCursoDet(item)}"
                                                            update="FormModalModificarCursoGeneral"
                                                            a:class="btn btn-secondary btn-sm" 
                                                             onstart="PF('loading').show();" 
                                                             oncomplete="PF('loading').hide();"
                                                            a:data-toggle="modal" a:data-target="#myModalCurso"   >
                                                            <i class="fas fa-edit"></i> 
                                                        </p:commandLink>
                                                        <p:commandLink 
                                                            rendered="#{cursoDetController.validarCurso== 1}"
                                                            a:class="btn btn-secondary btn-sm disabled" >
                                                          <i class="fas fa-edit"></i> 
                                                        </p:commandLink>
                                                    </td>
                                                    <td class="text-center">
                                                        <p:commandLink rendered="#{cursoDetController.validarCurso== 0}" 
                                                                       onstart="PF('loading').show();" 
                                                                       oncomplete="PF('loading').hide();"
                                                                       actionListener="#{cursoDetController.doCapturarCursoDet(item)}" a:data-toggle="modal" a:data-target="#myModal" a:class="btn btn-secondary btn-sm" >
                                                               <i class="fas fa-trash-alt"></i> 
                                                        </p:commandLink>
                                                        <p:commandLink rendered="#{cursoDetController.validarCurso== 1}" a:class="btn btn-secondary btn-sm disabled" >
                                                               <i class="fas fa-trash-alt"></i> 
                                                        </p:commandLink>
                                                    </td>

                                                    <td class="text-center">
                                                        
                                                          <!-- ver Planes -->
                                                        <p:commandLink rendered="#{cursoDetController.validarCurso== 1}" 
                                                                                           action="#{cursoDetController.doCapturarCurso()}"
                                                                                            onstart="PF('loading').show();" 
                                                                                             oncomplete="PF('loading').hide();"
                                                                                           a:data-toggle="modal" a:data-target="#modalVerTodosPlanes"
                                                                                           update=":formVerTodosPlanes :formCrearEnVerTodosPlanes :pagPlan" 
                                                                                           title="Ver Plan"  a:class="btn btn-secondary btn-sm">
                                                            <f:setPropertyActionListener value="#{item}" target="#{cursoDetController.selectedCursos}" />
                                                            <i class="fas fa-search"></i> Ver
                                                        </p:commandLink>
                                                             <!-- crear plan -->
                                                        <p:commandLink rendered="#{cursoDetController.validarCurso== 0}"
                                                                       action="#{cursoDetController.doBeforeCrearPlan()}"
                                                                       onstart="PF('loading').show();" 
                                                                       oncomplete="PF('loading').hide();"
                                                                        a:data-toggle="modal" a:data-target="#myModalCrearPlanFirst" 
                                                                        update=":createCrearPlanFirst:detplansitox" title="Crear Plan"  a:class="btn btn-primary btn-sm" >
                                                                        
                                                            <f:setPropertyActionListener value="#{item}" target="#{cursoDetController.selectedCursos}" />
                                                            <i class="fas fa-plus-circle"></i> Crear
                                                        </p:commandLink>

                                                    </td>
                                                    <td class="text-center">
                                                        <p:commandLink rendered="#{cursoDetController.validarCurso== 1}" 
                                                                                        onstart="PF('loading').show();" 
                                                                              oncomplete="PF('loading').hide();"
                                                                                           action="#{cursoDetController.doCargarCursosDetalladosDesdeCursosGenerales(item)}"
                                                                                           title="Agregar detalles"  a:class="btn btn-secondary btn-sm">
                                                            <i class="fas fa-search"></i> Cursos Detallados
                                                        </p:commandLink>
                                                        <p:commandLink rendered="#{cursoDetController.validarCurso== 0}" 
                                                                                           title="Agregar detalles"   a:class="btn btn-secondary btn-sm disabled">
                                                            <i class="fas fa-search"></i> Cursos Detallados
                                                        </p:commandLink>
                                                    </td>
                                                    <td class="text-center">
                                                        <p:commandLink rendered="#{cursoDetController.validarCurso== 1}" 
                                                                                                onstart="PF('loading').show();" 
                                                                                      oncomplete="PF('loading').hide();"
                                                                                           action="#{cursoDetController.doCrearCursoSubDetalle()}"
                                                                                           title="Agregar detalles"  a:class="btn btn-secondary btn-sm">
                                                            <f:setPropertyActionListener value="#{item}" target="#{cursoDetController.selectedCursos}" />
                                                            <i class="fas fa-plus-circle"></i> Agregar Detalle
                                                        </p:commandLink>
                                                        <p:commandLink rendered="#{cursoDetController.validarCurso== 0}" 
                                                                       disabled="true"  action="#{cursoDetController.doCrearCursoSubDetalle()}"
                                                                       a:class="btn btn-secondary btn-sm disabled">
                                                            <f:setPropertyActionListener value="#{item}" target="#{cursoDetController.selectedCursos}" />
                                                            <i class="fas fa-plus-circle"></i> Agregar Detalle
                                                        </p:commandLink>
                                                    </td>
                                                </tr>
                                            </p:repeat>
                                        </tbody>
                                    </table>
                                </div>
                            </h:form>
                            <!-- Center-aligned -->
                            <h:form id="pagCurDet">
                            <ul class="pagination justify-content-center" style="margin:20px 0">
                                <p:repeat  value="#{cursoDetController.paginacionCursoDet}" var="num">
                                       <li class="page-item">
                                           <p:commandLink a:class="page-link" value="#{num}" actionListener="#{cursoDetController.doCapturarPaginaCurDet(num)}"
                                                            onstart="PF('loading').show();" 
                                                           oncomplete="PF('loading').hide();" update="FormcursosGener" >
                                           </p:commandLink>
                                       </li>
                                   </p:repeat>    
                                  </ul>
                            </h:form>   
                        </div>
                    </div>
                </div>
                    
         <p:dialog widgetVar="loading"
                   modal="true"
                   draggable="false"
                   closable="false"
                   appendTo="@(body)"
                   resizable="false"                
                   >
             <div align="center" >
                 <img src="../../../resources/images/cargandoloading.gif" alt=""/>
                
             </div>
          
         </p:dialog>


              <!-- MODIFICAR CURSOS -->

                <div class="modal fade" id="myModalCurso" data-backdrop="static">
                    <div class="modal-dialog modal-md modal-dialog-centered">
                        <div class="modal-content">
                            
                                <!-- Modal Header -->
                                <div class="modal-header">
                                    <h4 class="modal-title"></h4>
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                </div>
                                <h:form id="FormModalModificarCursoGeneral">
                                 <p:growl id="msgbox" showDetail="true" showSummary="false"/>

                                <!-- Modal body -->
                                <div class="modal-body">
                                    <div class="container-fluid" >
                                              <div class="form-group">
                                               <p:outputLabel for="Mode" value="Tipo de Enseñanza: " />
                                               <p:selectOneMenu  id="Mode"  style="height: 35px;width: 100%" value="#{cursoDetController.selectedCursos.modEnsenanza}">
                                                   <f:selectItem  itemLabel="Curso" itemValue="1"/> 
                                                   <f:selectItem  itemLabel="Taller" itemValue="2"/> 
                                              </p:selectOneMenu>
                                            
                                             </div>
                                            <div class="form-group">
                                                <p:outputLabel for="consoleMod" value="Nombre Curso/Taller: " />
                                                <p:selectOneMenu  required="true" style="height: 35px;width: 100%" rendered="#{not empty cursoDetController.selectedCursos.cepCecCursoCab.idCursoCab}" converter="selectOneMenuConverter" id="consoleMod"  value="#{cursoDetController.selectedCursos.cepCecCursoCab}" effect="fade" 
                                                               filter="true" filterMatchMode="startsWith">
                                                  <f:selectItem itemLabel="Ninguno" itemValue="" />              
                                                  <f:selectItems var="item3"   value="#{cursoDetController.lstCursosNombres}"  itemLabel="#{item3.nomCurso}" itemValue="#{item3}" />  
                                                  <p:column>
                                                      <h:outputText value="#{item3.nomCurso}" />
                                                  </p:column>
                                              </p:selectOneMenu>
                                             </div>
                                           <div class="form-group">
                                                <p:outputLabel for="nivelesMod" value="Nivel: " />
                                                <p:selectOneMenu required="true" rendered="#{not empty cursoDetController.selectedCursos.cepNivel.idNivel}"  id="nivelesMod"  converter="selectOneMenuConverter" style="height: 35px;width: 100%" value="#{cursoDetController.selectedCursos.cepNivel}">
                                                  <f:selectItem itemLabel="Seleccionar" itemValue="" />              
                                                  <f:selectItems var="item4"   value="#{cursoDetController.doBuscarNivel()}"  itemLabel="#{item4.nombreNivel}" itemValue="#{item4}" />                       
                                              </p:selectOneMenu>
                                             </div>
                                           
                                           <div class="form-group">
                                               <p:outputLabel for="horas" value="Horas Lectivas: " />
                                               <p:inputText id="horas" a:type="number" value="#{cursoDetController.selectedCursos.horasLectivas}"  required="true" class="te" style="width: 100%"  />

                                             </div>
                                             
                                               <br/>
                                               <br/>
                                               
                                      </div>     
                                   
                                  
                                    </div>
                                <!-- Modal footer -->
                                <div class="modal-footer">
                                    <p:panelGrid   columns="2" columnClasses="ui-grid-col-5" layout="grid" styleClass="ui-panelgrid-blank">
                                        <p:commandLink value="Guardar Modificacion" ajax="false" update="msgbox,FormcursosGener" action="#{cursoDetController.doModificarCursoGeneral()}" a:class="btn btn-secondary" a:data-dismiss="modal"></p:commandLink> 
                                     </p:panelGrid>
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
                                </div>
                            </h:form> 
                        </div>
                    </div>
                </div>

                    
                    
                    
                     <!-- The Modal eliminar -->
            <h:form id="ModalConfirmacion">
                <div class="modal fade" id="myModal" data-backdrop="static">
                    <div class="modal-dialog modal-sm modal-dialog-centered">
                        <div class="modal-content">

                            <!-- Modal Header -->
                            <div class="modal-header">
                                <h4 class="modal-title"></h4>
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                            </div>

                            <!-- Modal body -->
                            <div class="modal-body">
                                Estas Seguro que desea Eliminar registro?
                            </div>
      

                            <!-- Modal footer -->
                            <div class="modal-footer">
                                 
                                
                             
                               <!-- Modal de la confirmacion de Eliminar de la tabla de cursos generaeles -->
                               <p:panelGrid>
                                   <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
                                   <p:commandLink ajax="false" value="Si" a:type="button" a:class="btn btn-secondary" a:data-dismiss="modal" actionListener="#{cursoDetController.doOcultarCurso()}" 
                                                  update=":FormcursosGener:msgbox :FormcursosGener">
                                  </p:commandLink>
                               </p:panelGrid>
                               
                            </div>

                        </div>
                    </div>
                </div>
            </h:form> 
                    
                    
                    
                <ui:include src="dlgCrearPlan.xhtml"/>
     
                
     <!-- Modal ver planes-->   
        <div class="container-fluid">
            
            <div class="modal fade" id="modalVerTodosPlanes" data-backdrop="static" >
                    <div class="modal-dialog modal-lg modal-dialog-centered" style="max-width: 65%">
                      
                        <div class="modal-content">
                          
                                <!-- Modal Header -->
                                <div class="modal-header">
                                    <h4 class="modal-title"></h4>
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                </div>
                      
                       

                                <!-- Modal body -->
                                <div class="modal-body">
                                 <h:form id="formCrearEnVerTodosPlanes">  
                                    <div class="row">
                                        <div class="col-lg">
                                            <p:commandLink rendered="#{grupoCursoController.doCompruebaSiPlanActivoEstaAsignadoAhGrupo(cursoDetController.id_curso_det)==1}" actionListener="#{cursoDetController.doBeforeCrearPlan()}" update=":createCrearPlan"   
                                                       a:class="btn btn-primary btn-sm"  a:data-toggle="modal" a:data-target="#myModalCrearPlan" a:data-dismiss="modal">
                                                      <i class="fas fa-plus-circle"></i> Nuevo Plan
                                            </p:commandLink>
                                        </div>
                                    </div>
                                    <br></br>
                                   </h:form>
                                   <h:form id="formVerTodosPlanes">  
                                     <p:tooltip />
                                    <p:growl id="msgbox" showDetail="true" showSummary="false"/>
                                    <div class="row">
                                        <div class="col-lg-12">
                                                <div class="table-responsive" align="center">
                                                    <table class="panel table table-hover">
                                                        <thead class="panel-heading" style="background-color: #eeeeee; color: #004276; ">
                                                            <tr align="center">
                                                                <th>#</th>
                                                                <th>Nombre del Plan</th>
                                                                <th>Estado</th>
                                                                <th colspan="3">Operaciones</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody  style="color: #000000; background-color: white">
                                                            <p:repeat   class="notas" value="#{cursoDetController.lstPlan}" var="item">
                                                                <tr>    
                                                                    <td class="text-center"> <h:outputText  value="#{item.idPlan}"/> </td>
                                                                    <td class="text-center"> <h:outputText value="#{item.detalles}"/> </td>
                                                                    <td class="text-center"> <h:outputText rendered="#{item.planActual}" value="Activo" a:style="color: #1cad1c;"/> 
                                                                        <h:outputText rendered="#{!item.planActual}" value="Inactivo" a:style="color: #f30000;"/> 
                                                                    </td>
                                                                    <td class="text-center"> 
                                                                    <p:commandLink 
                                                                        rendered="#{grupoCursoController.doCompruebaSiPlanEstaAsignadoAhGrupo(item.idPlan)==0}"
                                                                        actionListener="#{cursoDetController.doCapturarPlan(item)}"
                                                                        action="#{cursoDetController.redireccionAhModificarPlan()}"    
                                                                        a:class="btn btn-primary btn-sm" >
                                                                          <i class="fas fa-edit"></i> Editar
                                                                    </p:commandLink>
                                                                    <p:commandLink 
                                                                        rendered="#{grupoCursoController.doCompruebaSiPlanEstaAsignadoAhGrupo(item.idPlan)==1}"
                                                                        actionListener="#{cursoDetController.doCapturarPlan(item)}"  
                                                                        action="#{cursoDetController.redireccionAhVerPlan()}"
                                                                        a:class="btn btn-secondary btn-sm" >
                                                                          <i class="fas fa-search"></i> Ver
                                                                    </p:commandLink>    
                                                                    </td> 
                                                                    <td class="text-center">
                                                                         <p:commandLink rendered="#{grupoCursoController.doCompruebaSiPlanEstaAsignadoAhGrupo(item.idPlan)==0}"
                                                                                        actionListener="#{cursoDetController.doCapturarPlan(item)}" a:data-dismiss="modal" 
                                                                                        a:data-toggle="modal" a:data-target="#myModalPlanEli" a:class="btn btn-secondary btn-sm" >
                                                                                <i class="fas fa-trash-alt"></i> 
                                                                         </p:commandLink>
                                                                          <p:commandLink rendered="#{grupoCursoController.doCompruebaSiPlanEstaAsignadoAhGrupo(item.idPlan)==1}"
                                                                                         a:class="btn btn-secondary btn-sm disabled" >
                                                                                <i class="fas fa-trash-alt"></i> 
                                                                         </p:commandLink>
                                                                    </td> 
                                                                    <td class="text-center">
                                                                         <p:commandLink
                                                                                        actionListener="#{reportesController.doReportePlan(item)}" ajax="false"
                                                                                        a:class="btn btn-primary btn-sm" >
                                                                                <i class="fas fa-download"></i> 
                                                                         </p:commandLink>
                                                                    </td> 
                                                                    
                                                                </tr>
                                                            </p:repeat>
                                                        </tbody>
                                                    </table>
                                                </div>
                                          
                                        </div>
                                    </div>
                                     </h:form> 
                                     <h:form id="pagPlan">
                                            <ul class="pagination justify-content-center" style="margin:20px 0">
                                                <p:repeat  value="#{cursoDetController.paginacionPlan}" var="num">
                                                       <li class="page-item">
                                                           <p:commandLink a:class="page-link" value="#{num}" actionListener="#{cursoDetController.doCapturarPaginaPlan(num)}"
                                                                          onstart="PF('loading').show();" 
                                                                           oncomplete="PF('loading').hide();" update="formVerTodosPlanes" >
                                                           </p:commandLink>
                                                       </li>
                                               </p:repeat>    
                                            </ul>
                                     </h:form>   
                                </div>
                              
                                <!-- Modal footer -->
                                <div class="modal-footer">
                                  
                                   
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Salir</button>
                                </div>
                             </div>
                        </div>
                   </div>
              </div>     
  
     
     
           <!-- The Modal eliminar Plan-->
            <h:form id="ModalConfirmacionEliminarPlan">
                <p:tooltip />
                <p:growl id="msgbox" showDetail="true" showSummary="false"/>
                <div class="modal fade" id="myModalPlanEli" data-backdrop="static">
                    <div class="modal-dialog modal-sm modal-dialog-centered">
                        <div class="modal-content">

                            <!-- Modal Header -->
                            <div class="modal-header">
                                <h4 class="modal-title"></h4>
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                            </div>

                            <!-- Modal body -->
                            <div class="modal-body">
                                Estas Seguro que desea Eliminar Plan?
                            </div>
      

                            <!-- Modal footer -->
                            <div class="modal-footer">
                                 
                                
                             
                               <!-- Modal de la confirmacion de Eliminar de la tabla plan -->
                               <p:panelGrid>
                                   <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
                                   <p:commandLink value="Si" 
                                                  a:type="button" a:class="btn btn-secondary" a:data-dismiss="modal" 
                                                  a:data-toggle="modal" a:data-target="#modalVerTodosPlanes" 
                                                  action="#{cursoDetController.doOcultarPlan()}" 
                                                  onstart="PF('loading').show();" 
                                                  oncomplete="PF('loading').hide();"
                                                  update=":formCrearEnVerTodosPlanes :formVerTodosPlanes :pagPlan">
                                  </p:commandLink>
                               </p:panelGrid>
                               
                            </div>

                        </div>
                    </div>
                </div>
            </h:form>
           
          <!-- Modal create primer plan -->
              <div class="modal fade" id="myModalCrearPlanFirst" data-backdrop="static">
                    <div class="modal-dialog modal-md modal-dialog-centered">
                        <div class="modal-content">
                            <h:form id="createCrearPlanFirst">
                                <!-- Modal Header -->
                                <div class="modal-header btn-info">
                                    <h4 class="modal-title"></h4>
                                   
                                    <button type="button" class="close"  data-dismiss="modal">&times;</button>

                                </div>
                                
                                 <p:growl id="msgbox" showDetail="true" showSummary="false"/>

                                <!-- Modal body -->
                                <div class="modal-body">
                                    
                                  <p:panelGrid   columns="1" columnClasses="ui-grid-col-12" layout="grid" styleClass="ui-panelgrid-blank">
                                   <h:outputLabel  value="Se creará : "></h:outputLabel>
                                   <h:outputLabel id="detplansitox" value="#{cursoDetController.detPlan} "></h:outputLabel>
                                  </p:panelGrid>
                                                                  
                                </div>
                                <!-- Modal footer -->
                                <div class="modal-footer">
                                        <p:commandLink value="Crear"  update="msgbox,FormcursosGener" action="#{cursoDetController.doCrearPlan()}" a:class="btn btn-info" a:data-dismiss="modal">
                                        <i class="fas fa-save"></i>
                                        </p:commandLink> 
                                        
                                         <!-- <button type="button" class="btn btn-info"  data-dismiss="modal">No</button>--> 
                                   
                                </div>
                            </h:form> 
                        </div>
                    </div>
                </div>

          

            </ui:define>
        </ui:composition>

    </body>
</html>

